---
interface Props {
  /** Current page path for active state */
  currentPath: string;
  /** Optional mobile menu state */
  isMobileMenuOpen?: boolean;
}

const { currentPath } = Astro.props;

const navItems = [
  { href: '/', label: 'Home' },
  { href: '/about', label: 'About' },
  { href: '/portfolio', label: 'Portfolio' },
  { href: '/speaking', label: 'Speaking' },
];

function isActive(href: string): boolean {
  if (href === '/') {
    return currentPath === '/' || currentPath === '';
  }
  return currentPath.startsWith(href);
}
---

<nav class="navigation" aria-label="Main navigation">
  <button
    class="mobile-menu-toggle"
    aria-expanded="false"
    aria-controls="nav-menu"
    aria-label="Toggle navigation menu"
  >
    <span class="hamburger" aria-hidden="true"></span>
  </button>

  <ul id="nav-menu" class="nav-list">
    {navItems.map((item) => (
      <li>
        <a
          href={item.href}
          class:list={['nav-link', { active: isActive(item.href) }]}
          aria-current={isActive(item.href) ? 'page' : undefined}
        >
          {item.label}
        </a>
      </li>
    ))}
  </ul>
</nav>

<style>
  .navigation {
    display: flex;
    align-items: center;
  }

  .nav-list {
    display: flex;
    gap: var(--space-lg);
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .nav-link {
    color: var(--color-text);
    text-decoration: none;
    font-weight: 500;
    padding: var(--space-xs) var(--space-sm);
    border-radius: 4px;
    transition: color 0.2s ease, background-color 0.2s ease;
  }

  .nav-link:hover {
    color: var(--color-accent);
  }

  .nav-link:focus {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
  }

  .nav-link.active {
    color: var(--color-accent);
    background-color: var(--color-surface);
  }

  .mobile-menu-toggle {
    display: none;
    background: none;
    border: none;
    cursor: pointer;
    padding: var(--space-sm);
  }

  .hamburger {
    display: block;
    width: 24px;
    height: 2px;
    background-color: var(--color-text);
    position: relative;
    transition: background-color 0.2s ease;
  }

  .hamburger::before,
  .hamburger::after {
    content: '';
    position: absolute;
    left: 0;
    width: 24px;
    height: 2px;
    background-color: var(--color-text);
    transition: transform 0.2s ease;
  }

  .hamburger::before {
    top: -7px;
  }

  .hamburger::after {
    bottom: -7px;
  }

  @media (max-width: 768px) {
    .mobile-menu-toggle {
      display: block;
      z-index: 100;
    }

    .nav-list {
      position: fixed;
      top: 0;
      right: 0;
      width: 280px;
      height: 100vh;
      flex-direction: column;
      background-color: var(--color-background);
      padding: var(--space-2xl) var(--space-xl);
      gap: var(--space-md);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      box-shadow: -4px 0 16px rgba(0, 0, 0, 0.1);
      z-index: 99;
    }

    .nav-list.open {
      transform: translateX(0);
    }

    .mobile-menu-toggle[aria-expanded='true'] .hamburger {
      background-color: transparent;
    }

    .mobile-menu-toggle[aria-expanded='true'] .hamburger::before {
      transform: rotate(45deg) translate(5px, 5px);
    }

    .mobile-menu-toggle[aria-expanded='true'] .hamburger::after {
      transform: rotate(-45deg) translate(5px, -5px);
    }
  }
</style>

<script>
  const toggle = document.querySelector('.mobile-menu-toggle') as HTMLButtonElement | null;
  const navList = document.querySelector('.nav-list') as HTMLElement | null;
  const navLinks = navList?.querySelectorAll('a') as NodeListOf<HTMLAnchorElement> | undefined;

  function openMenu() {
    toggle?.setAttribute('aria-expanded', 'true');
    navList?.classList.add('open');
    // Focus first nav link when menu opens
    navLinks?.[0]?.focus();
  }

  function closeMenu() {
    toggle?.setAttribute('aria-expanded', 'false');
    navList?.classList.remove('open');
    // Return focus to toggle button
    toggle?.focus();
  }

  toggle?.addEventListener('click', () => {
    const expanded = toggle.getAttribute('aria-expanded') === 'true';
    if (expanded) {
      closeMenu();
    } else {
      openMenu();
    }
  });

  // Close menu on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && navList?.classList.contains('open')) {
      closeMenu();
    }
  });

  // Focus trap for mobile menu
  navList?.addEventListener('keydown', (e) => {
    if (!navList.classList.contains('open') || !navLinks?.length) return;

    if (e.key === 'Tab') {
      const firstLink = navLinks[0];
      const lastLink = navLinks[navLinks.length - 1];

      if (e.shiftKey && document.activeElement === firstLink) {
        e.preventDefault();
        lastLink.focus();
      } else if (!e.shiftKey && document.activeElement === lastLink) {
        e.preventDefault();
        firstLink.focus();
      }
    }
  });

  // Close menu when clicking outside
  document.addEventListener('click', (e) => {
    const target = e.target as Element;
    if (
      navList?.classList.contains('open') &&
      !navList.contains(target) &&
      !toggle?.contains(target)
    ) {
      closeMenu();
    }
  });
</script>
